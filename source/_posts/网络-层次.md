---
title: 网络-层次
categories: 
- 网络
tags:
- 网络
---


## 拓扑

![网络层](/images/网络/网络拓扑.png)
网络由节点、节点之间的链路和管理节点间数据传输的协议组成。


## OSI 7层网络结构
OSI（Open Systems Interconnection）七层结构。
层：是对网络上的功能和行为进行分类和分组的一种方式。
怎么记住这7层呢？
只要记一句：请不要把暗号告诉任何人（Please Do Not Tell the Secret Password to Anyone）就可以。
每个单词对应一个层：
- Please | 物理层（Physical Layer）
- Do | 数据链路层（Data Link Layer）
- Not | 网络层（Network Layer）
- Tell （the）| 传输层（Transport Layer）
- Secret | 会话层（Session Layer）
- Password （to）| 表示层（Presentation Layer）
- Anyone | 应用层（Application Layer）

![网络层](/images/网络/osi-7层网络结构.png)

### 物理层（Physical Layer）
物理层有很多技术——从物理网络设备、布线到电缆如何连接到设备之间的一切.
第一层的数据单元是比特（bit）。
### 数据链路层（Data Link Layer）
数据链路层定义了数据的传输格式、可以在节点间流动的数据量大小、数据流动可以持续的时长，以及在流中检测到错误时应采取的措施。
使用更加正式的技术术语描述如下：

- 线路规划。 谁应该交流多久？节点传输信息的时间应该持续多久？
- 流量控制。 应该传输的数据量是多少？
- 错误控制-检测和校正。 从电尖峰脉冲到卑鄙的连接器，所有的数据传输方法都有可能出错。一旦第二层的技术告知网络管理员有关第二层或第一层的问题，系统管理员就能为后续几层纠正那些错误。第二层主要关心的是错误检测，而不是错误校正。

第二层内有两个截然不同的子层：
- 介质访问控制（MAC，Media Access Control）： MAC 子层负责分配硬件标识号，这个标识号被称为 MAC 地址，它能够唯一标识网络上的各个设备。两个设备不应该有相同的 MAC 地址。MAC 地址在硬件制造时就分配好了，位于网卡当中，大多数网络都会自动对其进行识别。交换机会跟踪网络上所有的 MAC 地址。在这里和这里了解更多有关 MAC 地址的信息，在这里进一步了解网络交换机。
- 逻辑链路控制（LLC，Logical Link Control）: LLC 子层处理帧的寻址以及流量控制。速度取决于两个节点之间的链路，例如以太网或 Wifi。

第二层的数据单元是 帧（frame）。
每一帧都包括一个帧头、主体和一个帧尾：
- 帧头：通常包括源节点和目的节点的 MAC 地址。
- 主体：由要传输的比特组成。
- 帧尾：包括错误检测信息。当检测到错误时，根据实现或网络的配置或协议，帧可能被丢弃，或者错误会被报告给上面的层，用于进一步错误校正。例如，错误检测机制的有循环冗余校验（CRC，Cyclic Redundancy Check）和帧校验序列（FCS，Frame Check Sequence）。

帧的大小通常有一个最大值，这个值被称为最大传输单元（MTU，Maximum Transmission Unit）。巨型帧的大小超过了标准的 MTU。

### 网络层（Network Layer）
从网络层开始，我们通过路由器在网络间或跨网发送信息。不仅仅是节点到节点的通信，我们现在还可以进行网络到网络的通信了。
路由器是第三层的主力——它们是在第三层中必不可少。路由器跨越多个网络移动数据包。

路由器不仅通过连接到网络服务提供商（ISPs，Internet Service Providers）提供因特网访问，还跟踪着所在网络中的一切（记住交换机跟踪的是一个网络中所有的 MAC 地址），它所连接的其它网络，以及在这些网络中路由数据包的不同路径。

路由器将所有的地址和路由信息都保存在路由表中。

这里是一个简单的路由表示例：
![网络层](/images/网络/网络层-路由表.png)

第三层的数据单元是数据包（data packet）。通常，每个数据包都包含一个帧 加上 一个 IP 地址信息的包装。就是说第二层的帧被第三层的地址信息封装了。
数据包中传输的数据有时也被称为 负载（payload）。每个包都拥有到达目的地所需的一切，但是它能不能成功抵达就是另外一回事儿了。

第三层上的传输是无连接的、尽力而为的——除了将流量发往它应该去的地方，它们不会做任何事。更多与数据传输有关的协议在第四层。

节点一旦连接到因特网，它就会被赋予一个因特网协议（IP，Internet Protocol）地址，它看起来要么像 172.16.254.4（IPv4 地址），要么像 2001:0db8:85a3:0000:0000:8a2e:0370:7334（IPv6 地址）。路由器在它们的路由表中使用 IP 地址。

IP 地址通过地址解析协议（ARP，Address Resolution Protocol）与物理节点的 MAC 地址相关联，ARP 用节点对应的 IP 地址解析 MAC 地址。

ARP 通常被认为是第二层的一部分，但是由于 IP 地址在第三层以下都不存在，所以 ARP 也是第三层的一部分。

### 传输层（）
第四层是 传输层。在这里，我们会深入探讨了两个节点之间连接的具体细节，以及信息是如何在它们之间进行传输的。第四层建立在第二层的功能之上——线路规划、流量控制和错误控制。

这一层也负责数据包的分段，或者说数据包如何被拆分成小片并发往整个网络。

不像上一层，第四层也理解整个消息，而不只是每个独立的数据包的内容。根据对整个消息的理解，第四层不再一次性发送所有数据包，从而管理网络拥塞。

第四层的数据单元有好几个不同的名字，对于 TCP 而言，数据单元是数据包。对于 UDP 而言，包被称为数据报（datagram）。为了简化，我将只使用数据包这个术语。

第四层中最有名的两个协议是传输控制协议（TCP，Transmission Control Protocol）和用户数据报协议（UDP，User Datagram Protocol）。

TCP 是一个面向连接的协议，优先保证的是数据的质量而不是速度。

TCP 显式地与目的节点建立连接，并要求在数据传输时进行源节点与目的节点之间的握手操作。握手能够确认数据已经被接收。如果目的节点没有收到所有的数据，TCP 就会要求进行重传。

TCP 也会确保数据包以正确的顺序交付或者重组。从这里了解更多有关 TCP 的信息。

UDP 是一个无连接的协议，优先保证速度而不是数据的质量。UDP 不要求进行握手，这也正是它被称为无连接的原因。

因为 UDP 不必等待确认，所以它可以以更快的速度发送数据，但并非所有的数据都能成功传输，我们也不会知道哪些数据传输失败了。

如果信息被拆分成多个数据报，除非这些数据报都包含一个序列号，否则 UDP 无法确保以正确的顺序重组数据包。从这里了解更多有关 UDP 的信息。

TCP 和 UDP 都将数据发往网络设备上的特定端口，这些网络设备都有自己的 IP 地址。IP 地址和端口号的组合被称为套接字（socket）。

从这里了解更多有关套接字的信息。

从这里和这里了解 TCP 与 UDP 这两个协议之间的更多差异和相似之处。

### 会话层
第五层是 会话层，负责建立、维持和终止会话。

会话建立在两个网络应用之间，是双方商定好的连接。
会话是一个建立在两个特定的用户应用之间的连接，其中有一些重要的概念需要考虑：
- 客户端与服务器模型：请求信息的应用被称为客户端，拥有被请求信息的应用被称为服务器。
- 请求与响应模型：在建立会话的过程和会话期间，不断有来回的信息请求，还有包含被请求信息的响应或者是“嘿，我没有你要的东西”。

会话持续的时间可以非常短，也可以非常长，有时会话也可能会失败。

根据所采用的协议，会话可能会启动各种故障解决程序。根据所使用的应用程序/协议/硬件，会话可能支持单工，半双工或全双工模式。

第五层中协议的例子有网络基本输入输出系统（NetBIOS，Network Basic Input Output System）和远程过程调用协议（RPC，Remote Procedure Call Protocol）等等。

从这里往上（第五层及以上），网络关注的是与用户应用程序建立连接以及如何向用户展示数据。

### 表示层
表示层负责数据的格式，比如字符编码与转换，以及数据加密。
托管用户应用程序的操作系统通常包含第六层中的程序，这个功能并不总是被网络协议实现。

第六层确保第七层中的用户程序可以成功地消费数据，当然还有最终数据的展示。

有三种数据格式化方法需要注意：

- 美国信息交换标准代码（ASCII，American Standard Code for Information Interchange）：这个七位编码技术是字符编码中使用最广泛的标准。ASCII 的一个超集是 ISO-885901，它提供了西欧语言所必需的大多数字符。
- 扩充的二进制编码的十进制交换码（EBDCIC，Extended Binary-Coded Decimal Interchange Code）：由 IBM 设计，用于大型机。此编码与其他字符编码方法不兼容。
- 万国码（Unicode）：可以使用 32 位，16 位或 8 位字符的字符编码，它尝试容纳所有已知的字母。
从这里、这里还有这里了解有关字符编码的更多信息。

加密：SSL 或 TLS 加密协议位于第六层。这些加密协议为网络上的节点提供身份认证和数据加密功能，帮助确保传输的数据抵御恶意用户的攻击。TLS 是 SSL 继任者。

### 应用层
顾名思义，这一层最终负责支持用户程序使用的服务。应用程序包括安装在操作系统中的软件程序，比如因特网浏览器（例如 Firefox）或文字处理程序（例如 Microsoft Word）。

应用程序可以在后台执行专门的网络功能，也可以要求第七层中专门的服务。

例如专门创建电子邮件程序，它在网络上运行并利用第七层中网络功能（比如电子邮件协议）。

应用程序也可以控制用户交互，比如安全检查（例如 MFA）、识别两名参与者的身份、初始化信息交换等。

这一层中运行的协议包括文件传输协议（FTP，File Transfer Protocol）、安全壳协议（SSH，Secure Shell）、简单邮件传输协议（SMTP，Simple Mail Transfer Protocol）、因特网消息访问协议（IMAP，Internet Message Access Protocol）、域名服务（DNS，Domain Name Service）和超文本传输协议（HTTP，Hypertext Transfer Protocol）。

虽然这些协议中的每一个都服务于不同的功能，运行的方式也各不相同，但从较高的层次看，它们都促进了信息的交流。

## 参考
https://www.cloudflare.com/ko-kr/learning/ddos/glossary/open-systems-interconnection-model-osi/

https://blue-shadow.tistory.com/37

https://www.freecodecamp.org/chinese/news/osi-model-networking-layers/



